{
  "query": {
    "display_name": "02_bronze",
    "warehouse_id": "ba90f266beeaacb2",
    "query_text": "-- ============================================================\n-- BRONZE: LAPD Crime raw JSON â†’ Delta\n-- Environment: Databricks SQL Warehouse + Unity Catalog (2025)\n-- ============================================================\n\nUSE CATALOG public_crime;\nUSE SCHEMA bronze;\n\n-- 1. Drop and recreate to ensure clean schema (safe for first run)\nDROP TABLE IF EXISTS public_crime.bronze.lapd_crime_bronze;\n\n-- 2. Create Bronze Delta table (NO partitions, NO defaults)\nCREATE TABLE public_crime.bronze.lapd_crime_bronze (\n  dr_no            STRING,\n  date_rptd        STRING,\n  date_occ         STRING,\n  time_occ         STRING,\n  area             STRING,\n  area_name        STRING,\n  rpt_dist_no      STRING,\n  part_1_2         STRING,\n  crm_cd           STRING,\n  crm_cd_desc      STRING,\n  mocodes          STRING,\n  vict_age         STRING,\n  vict_sex         STRING,\n  vict_descent     STRING,\n  premis_cd        STRING,\n  premis_desc      STRING,\n  weapon_used_cd   STRING,\n  weapon_desc      STRING,\n  status           STRING,\n  status_desc      STRING,\n  crm_cd_1         STRING,\n  crm_cd_2         STRING,\n  crm_cd_3         STRING,\n  crm_cd_4         STRING,\n  location         STRING,\n  cross_street     STRING,\n  lat              STRING,\n  lon              STRING\n)\nUSING DELTA;\n\n-- 3. Incremental load from S3 JSON (idempotent)\n--    Requires External Location on bucket or parent prefix\nCOPY INTO public_crime.bronze.lapd_crime_bronze\nFROM 's3://public-crime-raw-dev-eu-west-1/bronze/lapd_crime/json/'\nFILEFORMAT = JSON\nFORMAT_OPTIONS (\n  'multiLine' = 'true'\n)\nCOPY_OPTIONS (\n  'mergeSchema' = 'true',\n  'on_error' = 'continue'\n);\n\n-- 4. Sanity checks\nSELECT COUNT(*) AS bronze_rows\nFROM public_crime.bronze.lapd_crime_bronze;\n\nSELECT *\nFROM public_crime.bronze.lapd_crime_bronze\nLIMIT 10;\n"
  }
}
