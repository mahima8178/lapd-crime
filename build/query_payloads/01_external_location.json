{
  "query": {
    "display_name": "01_external_location",
    "warehouse_id": "ba90f266beeaacb2",
    "query_text": "-- 01_external_location.sql\n-- Goal: External Location setup with existing storage credential\n-- This fixes: NO_PARENT_EXTERNAL_LOCATION_FOR_PATH\n-- Uses existing storage credential: db_s3_credentials_databricks-s3-ingest-5d3d2\n\n-- Grant permission to create external locations (metastore level)\nGRANT CREATE EXTERNAL LOCATION ON METASTORE TO `mahima.thakur@sigmoidanalytics.com`;\n\n-- Grant permission to use existing storage credential\nGRANT USE CREDENTIAL ON STORAGE CREDENTIAL `db_s3_credentials_databricks-s3-ingest-5d3d2` TO `mahima.thakur@sigmoidanalytics.com`;\n\n-- Create external location using existing credential\nCREATE EXTERNAL LOCATION IF NOT EXISTS `db_s3_external_databricks-s3-ingest`\nURL 's3://public-crime-raw-dev-eu-west-1/'\nWITH (CREDENTIAL `db_s3_credentials_databricks-s3-ingest-5d3d2`)\nCOMMENT 'Parent external location for raw/bronze/silver/gold prefixes';\n\n-- Grant permissions on external location\nGRANT USE LOCATION ON EXTERNAL LOCATION `db_s3_external_databricks-s3-ingest` TO `mahima.thakur@sigmoidanalytics.com`;\nGRANT READ FILES ON EXTERNAL LOCATION `db_s3_external_databricks-s3-ingest` TO `mahima.thakur@sigmoidanalytics.com`;\nGRANT WRITE FILES ON EXTERNAL LOCATION `db_s3_external_databricks-s3-ingest` TO `mahima.thakur@sigmoidanalytics.com`;\n\n-- Sanity checks\nSHOW STORAGE CREDENTIALS;\nSHOW EXTERNAL LOCATIONS;\nDESCRIBE EXTERNAL LOCATION `db_s3_external_databricks-s3-ingest`;\n\n-- Verify S3 path is accessible\nLIST 's3://public-crime-raw-dev-eu-west-1/';\n\n"
  }
}
